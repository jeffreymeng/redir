<html>
<head>
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

</head>
<body>
    <h1>Redirect</h1>
<p class="text-muted">Jeffrey's link redirection service. <span is="ys">You should be redirected to your destination in under 30 seconds.</span></p>
<div id="create">
<p>Welcome to redir</p>
<p>Create a redirection link below:</p>
<form>
    <input type="text" placeholder="Please enter the name of your redirection" id="n" class="form-control">
    <input type="text" placeholder="Please enter the link to redirect to" id="l" class="form-control">

    <button onclick="create()" class="form-control" style="color:green;"></button>
</form>
</div>
	<script>
   $("#ys").hide()
   function create() {
    var name = $("#n").val()

    var fb = new Firebase("https://jeffreymeng.firebaseio.com/redir");
        fb.once("value", function(snapshot) {
        if (snapshot.child(name).val() !== null) {
            $(".warningtxt").remove();
            $("#create").append("<p class='text-danger warningtxt'>Your name was already taken, please choode another name.</p>")
        } else {
            $("#create").empty();
            $("#create").append("<p>your link has been created</p>")
            fb.child(name).set($("#l").val())
        }
   }
	function getQuery(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }
    var name = window.location.hash.substring(1)
    var fb = new Firebase("https://jeffreymeng.firebaseio.com/redir");
        fb.once("value", function(snapshot) {
        if (snapshot.child(name).val() !== null) {
            $("#ys").show();
            window.location.href = snapshot.child(name).val();
        } else {
            $("#create").show();
        }
        
    });

	</script>

</body>
</html>