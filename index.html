<!DOCTYPE html>
<html>
    <head>
    
        <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js">
        </script>
        <script>
            /* global Firebase */
            var name = window.location.hash.substring(1);
            var fb = new Firebase("https://redirect.firebaseio.com");
            if (name !== null && name !== "" && name !== undefined) {
                fb.once("value", function(snapshot) {
                    if (snapshot.child(name).val() !== null) {
                        var meta = document.createElement('meta');
                        meta.httpEquiv = "refresh";
                        meta.content = "0; URL=" + snapshot.child(name).val();
                        document.getElementsByTagName('head')[0].appendChild(meta);
    
                    }
                });
            }
    
        </script>
        <link href=
        "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        rel="stylesheet">
        <title></title>
    </head>
    <body>
        <div class="container">
            <div class="col-lg-12">
                <h1>Redirect</h1>
                <p class="text-muted">Jeffrey's link redirection service.</p>
                <div id="create">
                    <p>Welcome to redir</p>
                    <p>Create a redirection link below:</p>
                    <div>
                        <label for="basic-url">Choose a URL</label>
                        <div class="input-group">
                            <span class="input-group-addon" id=
                            "basic-addon3">http://jmls.tk#</span>
                            <input aria-describedby="basic-addon3" class=
                            "form-control" id="url" placeholder="url" type="text">
                        </div><br>
                        <label for="link">Link to redirect to</label> <input class=
                        "form-control" id="link" placeholder=
                        "Please enter the link to redirect to" type="text"><br>
                        <p class="text-danger text" id="error"></p>
                        <p class="text-success text" id="success">
                        </p><button class="form-control" id="sub" style=
                        "background-color:green;color:white;" onclick="setup()">Submit</button>
                    </div>
                </div>
                <script src="http://code.jquery.com/jquery-1.11.3.min.js">
                </script> 
                <script src="https://cdn.firebase.com/js/client/2.3.2/firebase.js">
                </script> 
                <script src=
                "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js">
                </script> 
                <script>
                window.onhashchange = function() {
                    setTimeout(function(){window.location.reload();}, 100);
                }
                    /* global Firebase */
                var fb = new Firebase("https://redirect.firebaseio.com");
                var doc = jQuery(document);
                doc.ready(setup);
                function checkIfUserExists(id, link, callback) {
                  fb.child(id).once('value', function(snapshot) {
                    var exists = (snapshot.val() !== null);
                    callback(exists, id, link);
                  });
                }
    
                function setup() {
                        var url = $("#url").val();
                        var link = $("#link").val();
                        checkIfUserExists(url, link, function(exists, id, link){
                            if (exists) {
                                $("#error").html("Your url already exists!")
                            } else {
                                fb.child(url).set(link);
                                $("#success").html("Sucuess! The link <b>http://jmls.tk#" + url + "<\/b> now redirects to <b>" + link + "<\/b>.")
                                
                            }
                        });
                    
                }
    
    
                </script>
            </div>
        </div>
    </body>
</html>