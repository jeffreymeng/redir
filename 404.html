<html>

<head></head>

<body>
    <h1>Loading...</h1>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-database.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDoXIdwM34SiFL2jB055Jo4VdyJk-pVIDA",
            authDomain: "jcabinet.firebaseapp.com",
            databaseURL: "https://jcabinet.firebaseio.com",
            projectId: "firebase-jcabinet",
            storageBucket: "firebase-jcabinet.appspot.com",
            messagingSenderId: "1056566579088"
        };
        firebase.initializeApp(config);
    </script>
    <script>
        var template = `
                <html><head>
                <link rel="stylesheet" type="text/css" href="https://cdn.jeffkmeng.com/library/bootstrap/4.0.0/css/bootstrap.min.css">
                </head><body>
                <div class="container">
                    <div class="col-lg-12">
                        <h1>404 Error: File not found</h1>
                        <p class="text-muted">JKMLS</p>
                        <hr>
                        <p>The link you are at did not match a short link on JKMLS. If you hand-typed this link, double check your spelling. <br>
                         If you would like to create your own short links you can <a href="/">click here to return to main page</a>.</p>

                    </div>
                </div>
        `;

        if (window.location.pathname.substring(1) !== "") {
            firebase.database().ref("/links/jmls/" + encodeURIComponent(window.location.pathname.substring(1)) + "/").once("value").then(function (snapshot) {
                var data = snapshot.val();
                console.log(data);
                if (data != null && data != false) {//false for reserved words, explicit just because
                    if (data.options == null) {
                        window.location.href = data.link;
                    } else {
                        if (data.options.addMetadata) {
                            if (data.link.indexOf("?") <= -1) {
                                data.link = data.link + "?"
                            } else {
                                data.link = data.link + "&"
                            }
                            data.link = data.link + "jkmlsmetadata=" + encodeURIComponent(JSON.stringify({
                                timestamp:{
                                    utc:Date.now(),
                                    string:Date()
                                },
                                name:window.location.pathname.substring(1),
                                redirLink:data.link
                            }));
                            window.location.href = data.link;
                        }
                    }
                } else {
                    document.open();//clears everything

                    document.write(template);
                }
            });
        } else {
            document.open();//clears everything

            document.write(template);
        }

    </script>

</body>

</html>